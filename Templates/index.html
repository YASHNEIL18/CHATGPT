<!DOCTYPE html>
<html>
<head>
    <title>TemuGPT Deluxe</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* ===== GLOBAL ===== */
        :root {
            --bg1: #6ea0ff;
            --bg2: #c084fc;
            --bg3: #ff6ec4;

            --bubble-user: #4da3ff;
            --bubble-bot: rgba(255,255,255,0.9);
            --text-dark: #222;
            --text-light: #fff;
        }

        body {
            font-family: "Inter", sans-serif;
            margin: 0;
            padding: 30px;
            background: linear-gradient(135deg, var(--bg1), var(--bg2), var(--bg3));
            background-size: 300% 300%;
            animation: bgMove 12s ease infinite;
            transition: 0.4s;
            overflow-x: hidden;
        }

        body.dark {
            background: #0d1117 !important;
            color: #ffffff;
        }

        @keyframes bgMove {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .topbar {
            position: sticky;
            top: 0;
            z-index: 99;
            text-align: center;
            margin-bottom: 15px;
            color: white;
            text-shadow: 0 2px 10px rgba(0,0,0,0.4);
            padding: 20px 0;
            backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(255,255,255,0.35);
            box-shadow: 0 4px 22px rgba(0,0,0,0.25);
        }

        .toggle-dark {
            background: rgba(255,255,255,0.2);
            padding: 8px 14px;
            border-radius: 10px;
            cursor: pointer;
            border: 1px solid rgba(255,255,255,0.4);
            margin-top: 10px;
            backdrop-filter: blur(6px);
            display: inline-block;
        }

        #chatbox {
            width: 100%;
            max-width: 750px;
            margin: auto;
            height: 520px;
            overflow-y: auto;
            padding: 22px;
            background: rgba(255,255,255,0.15);
            border-radius: 20px;
            border: 2px solid rgba(255,255,255,0.3);
            box-shadow: 0 25px 45px rgba(0,0,0,0.3);
            backdrop-filter: blur(14px);
            position: relative;
        }

        .msg-container {
            display: flex;
            align-items: flex-end;
            margin-bottom: 18px;
            animation: fadeIn 0.25s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(12px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .msg {
            padding: 14px 16px;
            border-radius: 16px;
            max-width: 75%;
            font-size: 15px;
            line-height: 1.5;
        }

        .bot-wrap { justify-content: flex-start; }
        .bot { background: var(--bubble-bot); color: var(--text-dark); border: 1px solid rgba(255,255,255,0.4); box-shadow: 0 4px 14px rgba(0,0,0,0.18); border-bottom-left-radius:6px; border-top-left-radius:18px; border-top-right-radius:18px;}
        .user-wrap { justify-content: flex-end; }
        .user { background: var(--bubble-user); color: white; box-shadow: 0 6px 18px rgba(0,0,0,0.25); border-bottom-right-radius:6px; border-top-left-radius:18px; border-top-right-radius:18px;}

        .avatar { width: 40px; height: 40px; border-radius: 50%; margin-right:10px; }
        .avatar-bot { background-image: url('https://cdn-icons-png.flaticon.com/512/4712/4712100.png'); background-size: cover; }
        .avatar-user { background-image: url('https://cdn-icons-png.flaticon.com/512/1946/1946429.png'); background-size: cover; margin-left:10px; }

        #inputBox {
            width: 100%;
            max-width: 750px;
            margin: 25px auto;
            display: flex;
            gap: 8px;
            background: rgba(255,255,255,0.85);
            padding: 14px;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.25);
            align-items: flex-end;
        }

        textarea {
            flex: 1;
            padding: 14px;
            border: none;
            background: #f4f4f4;
            border-radius: 12px;
            font-size: 16px;
            resize: none;
            min-height: 40px;
            max-height: 140px;
            outline: none;
        }

        button, #emojiBtn {
            padding: 12px 18px;
            border: none;
            border-radius: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.2s;
        }

        button { background: #4da3ff; color:white; }
        button:hover { background: #1e8cff; }

        #emojiBtn { background: #ffffffaa; font-size: 22px; }
        #emojiBtn:hover { background:#ffffffdd; }

        .typing { font-style: italic; opacity:0.7; margin-left:55px; }
        .timestamp { font-size:11px; opacity:0.6; margin:4px; text-align:right; }

        /* Emoji floating background */
        .emoji-floating { position: fixed; top:-50px; font-size:40px; animation: floatDown linear infinite; opacity:0.8; pointer-events:none; }
        @keyframes floatDown { from {transform: translateY(-60px) translateX(0);} to {transform: translateY(110vh) translateX(20px);} }
    </style>
</head>
<body>

<div class="topbar">
    <h2>TemuGPT Deluxe</h2>
    <div class="toggle-dark" onclick="toggleDark()">ðŸŒ™ Toggle Dark Mode</div>
</div>

<div style="text-align:center; margin-bottom:10px;">
    <input id="apiKey" type="password" placeholder="Enter OpenRouter API Key" style="width:300px; padding:10px; border-radius:10px;">
</div>

<div id="chatbox"></div>

<div id="inputBox">
    <button id="emojiBtn">ðŸ˜€</button>
    <textarea id="message" placeholder="Type your message..." oninput="autoResize(this)"></textarea>
    <button onclick="sendMessage()">Send</button>
</div>

<!-- âœ… Audio elements -->
<audio id="sendSound" src="https://assets.mixkit.co/sfx/preview/mixkit-message-pop-alert-2354.mp3"></audio>
<audio id="receiveSound" src="https://assets.mixkit.co/sfx/preview/mixkit-soft-pop-click-2350.mp3"></audio>

<script>
/* ===== Dark Mode ===== */
function toggleDark(){ document.body.classList.toggle("dark"); }

/* ===== Auto-resize textarea ===== */
function autoResize(el){ el.style.height="40px"; el.style.height=(el.scrollHeight)+"px"; }

/* ===== Emoji Picker ===== */
let pickerVisible=false;
let picker;
document.getElementById("emojiBtn").onclick=function(){
    if(!picker){
        picker=document.createElement("div");
        picker.style.position="absolute";
        picker.style.bottom="70px";
        picker.style.left="20px";
        picker.style.zIndex="9999";
        picker.style.background="white";
        picker.style.border="1px solid #ccc";
        picker.style.borderRadius="10px";
        picker.style.padding="10px";
        picker.style.display="grid";
        picker.style.gridTemplateColumns="repeat(6,1fr)";
        picker.style.gap="6px";
        const emojis=["ðŸ˜€","ðŸ˜‚","ðŸ˜","ðŸ˜Ž","ðŸ”¥","âœ¨","ðŸ¤–","ðŸŽ‰","â¤ï¸","ðŸ’«"];
        emojis.forEach(e=>{
            let b=document.createElement("button");
            b.style.fontSize="22px";
            b.style.border="none";
            b.style.background="transparent";
            b.textContent=e;
            b.onclick=()=>{ document.getElementById("message").value+=e; autoResize(document.getElementById("message")); };
            picker.appendChild(b);
        });
        document.body.appendChild(picker);
    }
    pickerVisible=!pickerVisible;
    picker.style.display=pickerVisible?"grid":"none";
};

/* ===== Floating emoji background ===== */
const emojis = ["ðŸ”¥", "âœ¨", "ðŸ¤–", "ðŸŽ‰", "ðŸ’™", "âš¡", "ðŸ˜Ž"];
function spawnEmoji(){ 
    let e=document.createElement("div"); 
    e.className="emoji-floating"; 
    e.textContent=emojis[Math.floor(Math.random()*emojis.length)]; 
    e.style.left=Math.random()*100+"vw"; 
    e.style.animationDuration=4+Math.random()*7+"s"; 
    document.body.appendChild(e); 
    setTimeout(()=>e.remove(),12000); 
}
setInterval(spawnEmoji,800);

/* ===== Send Message ===== */
async function sendMessage(){
    const msg=document.getElementById("message").value;
    const key=document.getElementById("apiKey").value;
    if(!msg||!key) return alert("Enter message and API key!");

    let sendAudio=document.getElementById("sendSound");
    if(sendAudio) sendAudio.play();

    addMessage("user",msg);
    document.getElementById("message").value="";

    showTyping();
    try{
        const response=await fetch("/chat",{
            method:"POST",
            headers:{"Content-Type":"application/json"},
            body:JSON.stringify({api_key:key,message:msg})
        });
        const data=await response.json();
        hideTyping();
        typeWriterMessage(data.reply||"Error occurred","bot");
    }catch(e){
        hideTyping();
        addMessage("bot","Error: "+e.message);
    }
}

/* ===== Typing indicator ===== */
function showTyping(){
    const box=document.getElementById("chatbox");
    let div=document.createElement("div");
    div.id="typing";
    div.className="typing";
    div.textContent="Bot is typing...";
    box.appendChild(div);
    box.scrollTop=box.scrollHeight;
}
function hideTyping(){
    let t=document.getElementById("typing");
    if(t) t.remove();
}

/* ===== Typewriter effect for bot ===== */
function typeWriterMessage(text,sender){
    let container=prepareMessageShell(sender);
    let bubble=container.querySelector(".msg");
    let i=0,speed=18;
    let recvAudio=document.getElementById("receiveSound");
    if(recvAudio) recvAudio.play();
    function typeNext(){ 
        if(i<text.length){ 
            bubble.textContent+=text.charAt(i); 
            i++; 
            document.getElementById("chatbox").scrollTop=document.getElementById("chatbox").scrollHeight; 
            setTimeout(typeNext,speed); 
        } 
    }
    typeNext();
}

/* ===== Add message shell ===== */
function prepareMessageShell(sender){
    const box=document.getElementById("chatbox");
    const wrapper=document.createElement("div");
    wrapper.className="msg-container "+(sender==="user"?"user-wrap":"bot-wrap");

    if(sender==="bot"){
        let avatar=document.createElement("div");
        avatar.className="avatar avatar-bot";
        wrapper.appendChild(avatar);
    }

    const bubble=document.createElement("div");
    bubble.className="msg "+sender;
    wrapper.appendChild(bubble);

    if(sender==="user"){
        let avatar=document.createElement("div");
        avatar.className="avatar avatar-user";
        wrapper.appendChild(avatar);
    }

    let timestamp=document.createElement("div");
    timestamp.className="timestamp";
    timestamp.textContent=new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
    wrapper.appendChild(timestamp);

    box.appendChild(wrapper);
    box.scrollTop=box.scrollHeight;
    return wrapper;
}

/* ===== Add message (for user instantly) ===== */
function addMessage(sender,text){ prepareMessageShell(sender).querySelector(".msg").textContent=text; }

/* ===== Enter to send ===== */
document.getElementById("message").addEventListener("keydown",function(e){
    if(e.key==="Enter"&&!e.shiftKey){ e.preventDefault(); sendMessage(); }
});
</script>

</body>
</html>
